# 动计笔记 - 完整项目计划

> 整合「现有项目需求」+「AI教练功能需求」的综合开发计划
>
> 更新日期：2026-02-01

---

## 📋 项目概述

**项目名称**：动计笔记 (MovePlan Memo) - AI智能教练版

**项目定位**：一款融合**日常记事**、**智能提醒**、**运动追踪**、**AI教练**的全能生活管理APP。通过AI生成个性化饮食+训练计划，结合心率监测技术，帮助用户科学健身、达成目标。

**目标用户**：
- 希望科学健身的上班族、学生
- 需要个性化饮食+训练计划的健身爱好者
- 希望通过数据监测提升运动效果的用户

---

## 🎯 功能模块全景图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              动计笔记 - 功能架构                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │  记事本模块   │  │  提醒模块    │  │  运动模块     │  │  计划模块     │   │
│  │              │  │             │  │              │  │              │   │
│  │ • 笔记CRUD   │  │ • 本地推送  │  │ • 运动记录   │  │ • 目标计划   │   │
│  │ • 标签系统   │  │ • 重复提醒  │  │ • 类型库(20+)|  │ • 任务分解   │   │
│  │ • 搜索功能   │  │ • 习惯提醒  │  │ • 数据统计   │  │ • 进度追踪   │   │
│  │ • 富文本编辑 │  │ • 位置提醒  │  │ • GPS追踪   │  │ • 日历视图   │   │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘   │
│         │                 │                 │                 │             │
│         └─────────────────┴─────────────────┴─────────────────┘             │
│                                   │                                         │
│                    ┌──────────────┴──────────────┐                           │
│                    │      AI教练核心模块          │                           │
│                    │                              │                           │
│                    │  ┌────────────────────┐     │                           │
│                    │  │  用户画像采集      │     │                           │
│                    │  │  • 目标/基础信息   │     │                           │
│                    │  │  • 限制条件/偏好   │     │                           │
│                    │  └─────────┬──────────┘     │                           │
│                    │            │                 │                           │
│                    │  ┌─────────┴──────────┐     │                           │
│                    │  │  AI计划生成引擎    │     │                           │
│                    │  │  • 训练计划生成    │     │                           │
│                    │  │  • 饮食计划生成    │     │                           │
│                    │  │  • 动态迭代优化    │     │                           │
│                    │  └─────────┬──────────┘     │                           │
│                    │            │                 │                           │
│                    │  ┌─────────┴──────────┐     │                           │
│                    │  │  心率监测系统      │     │                           │
│                    │  │  • 蓝牙心率带连接  │     │                           │
│                    │  │  • 实时心率监测    │     │                           │
│                    │  │  • 动态强度调整    │     │                           │
│                    │  └────────────────────┘     │                           │
│                    └─────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                          亮点功能                                    │  │
│  │  • AI运动教练与计划生成    • 运动后AI自动生成笔记                      │  │
│  │  • 游戏化系统(连击/成就)   • 智能天气适配                             │  │
│  │  • 情绪分析                • 语音交互                                 │  │
│  │  • 番茄专注+运动休息       • 个性化主题与小组件                       │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 📊 项目进度总览

### 当前状态（2026-02-05 更新）

```
阶段0: 项目搭建      → 已完成   [✓] 2025-01-29
阶段1: 基础架构      → 已完成   [✓] 2025-01-29
阶段2: UI 框架       → 已完成   [✓] 2025-01-29
阶段3: 数据层        → 已完成   [✓] 2025-01-29
阶段4: 提醒模块      → 已完成   [✓] 2025-01-29
阶段5: 运动模块      → 已完成   [✓] 2025-01-29
阶段6: 计划模块      → 已完成   [✓] 2025-01-29
阶段7: 整合打磨      → 已完成   [✓] 2026-01-30
阶段8: AI基础设施    → 已完成   [✓] 2026-02-02
阶段9: AI教练核心    → 已完成   [✓] 2026-02-02
阶段10: 笔记增强     → 已完成   [✓] 2026-02-03
阶段11: AI教练集成   → 已完成   [✓] 2026-02-03
阶段12: 代码修复     → 已完成   [✓] 2026-02-04
阶段13: 心率监测     → 已完成   [✓] 2026-02-04 多智能体并行完成
阶段14: GPS追踪      → 已完成   [✓] 2026-02-04 基础功能98%完成
阶段15: 数据可视化   → 已完成   [✓] 2026-02-04 仓库层+UI全部完成
阶段16: 智能天气     → 已完成   [✓] 2026-02-04 天气适配功能完成
阶段17: 游戏化系统   → 已完成   [✓] 2026-02-04 挑战+抽卡系统完成
阶段18: 项目全面分析 → 已完成   [✓] 2026-02-05 8智能体并行分析完成
--------------------------------------------------
阶段19: 高级功能完善 → 待开始   [ ] 预计 25-35h
```

### 今日进展 (2026-02-04) - 多智能体并行开发

#### 上午：代码修复
- ✅ 修复多智能体代码遗留的编译错误
- ✅ 修复 workout_stats_page.dart 语法错误（注释掉的回调）
- ✅ 修复 database.dart 语法错误（函数内import语句）
- ✅ 修复 AndroidManifest.xml 元素顺序和命名（feature → uses-feature）
- ✅ 修复 heart_rate_providers.dart 缺失导入
- ✅ 修复 EmptyStateWidget 参数名（message → description）
- ✅ 修复 workout_line_chart.dart 类型错误

#### 下午：多智能体并行开发
**智能体1 - 心率监测模块完善**
- ✅ 创建心率数据仓库层 (`heart_rate_repository.dart`)
- ✅ 创建心率区间配置页面 (`heart_rate_settings_page.dart`)
- ✅ 添加实时心率曲线图组件 (`realtime_heart_rate_chart.dart`)
- ✅ 更新路由和Provider配置

**智能体2 - 数据可视化仓库层**
- ✅ 修复 `workout_stats_models.dart` 重复枚举定义
- ✅ 实现9个统计方法（每日/类型/趋势/周度/月度/卡路里）
- ✅ 修正卡路里返回类型 `double` → `int`
- ✅ 验证数据流完整性

**智能体3 - 心率配置和数据仓库**
- ✅ 完善心率数据仓库（带缓存优化）
- ✅ 心率区间配置页面（5个区间可自定义）
- ✅ Provider配置和路由添加

#### 编译验证结果
```bash
flutter analyze
✅ 0 errors
⚠️ 15 warnings
ℹ️ 851 info (代码风格建议)
```

### 编译验证结果

```bash
flutter analyze
✅ 0 errors
⚠️ 1 warning (unused_element_parameter)
ℹ️ 692 info (代码风格建议)
```

### 今日进展 (2026-02-03)

- ✅ AI教练与现有模块整合完成
- ✅ 创建 `PlanIntegrationService` 整合服务
- ✅ 训练计划展示页添加激活计划按钮
- ✅ 运动完成自动打卡到AI计划
- ✅ 编译成功并安装到手机

### 已完成的多代理任务
- ✅ 心率监测BLE框架搭建 (Task a32f75c)
- ✅ GPS追踪功能实现 (Task a2fd079)
- ✅ 数据可视化图表实现 (Task aa599cd)
- ✅ AI计划迭代优化功能 (Task ada8206)
- ✅ **心率监测模块完善** (Task abfce1) - 2026-02-04
- ✅ **数据可视化仓库层** (Task a11ab92) - 2026-02-04
- ✅ **心率配置页面** (Task a67855a) - 2026-02-04

### 今日进展 (2026-02-02)

- ✅ AI教练核心功能完整实现并编译通过
- ✅ 用户画像采集页面 (UserProfileSetupPage) - 5步采集流程
- ✅ AI计划生成页面 (CoachPlanGenerationPage) - 进度展示
- ✅ 训练计划展示页面 (WorkoutPlanDisplayPage) - 概览/日程双Tab
- ✅ 饮食计划展示页面 (DietPlanDisplayPage) - 概览/餐次/采购三Tab
- ✅ AI设置页面 (AISettingsPage) - DeepSeek API Key配置
- ✅ 设置页面集成AI教练入口

### 昨日进展 (2026-02-01)

- ✅ 修复首页布局错误（Expanded → Flexible，添加 IntrinsicHeight）
- ✅ 修复 withValues 兼容性问题 → withOpacity
- ✅ 设置默认 DeepSeek API key (sk-c854090502824575a257bc6da42f485f)
- ✅ 应用成功安装到手机并运行
- ✅ AI教练入口已添加到设置页面和首页

### 完成度统计

| 模块 | 完成度 | 说明 |
|------|--------|------|
| 记事本模块 | 75% | 核心CRUD完成，缺少富文本、图片插入 |
| 提醒模块 | 50% | P0/P1完成，缺少导航入口、早安推送 |
| 运动模块 | 95% | GPS追踪、数据可视化完成，仅需优化 |
| 计划模块 | 70% | P0/P1完成，缺少模板库、AI集成、甘特图 |
| AI教练模块 | 95% | 核心功能完整，仅需UI优化 |
| 心率监测模块 | 90% | BLE+实时监测完成，缺少异常提醒 |
| 数据可视化 | 100% | 图表组件+仓库层全部完成 |
| 游戏化系统 | 95% | 挑战+抽卡框架完成，需物品池定义 |
| 情绪分析 | 75% | 数据层完成，算法需完善 |
| 天气适配 | 70% | 框架完成，需API集成 |
| 语音功能 | 65% | UI完成，服务层未实现 |

---

## 📝 详细功能清单

### 1. 记事本模块 (优先级: P0-P3)

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 基础CRUD | P0 | ✅ 完成 | - | 新建、编辑、删除、查看 |
| 笔记列表 | P0 | ✅ 完成 | - | 时间排序展示 |
| 标签系统 | P0 | ✅ 完成 | - | 多标签支持 |
| 按标签筛选 | P1 | ✅ 完成 | - | 点击标签查看 |
| 搜索功能 | P1 | ✅ 完成 | - | 全文搜索标题和内容 |
| 文件夹分类 | P2 | ✅ 完成 | 6h | 文件夹选择+筛选 |
| 富文本编辑 | P2 | ✅ 完成 | 8h | Markdown工具栏（8种格式）|
| 图片插入 | P2 | ✅ 完成 | 4h | 从相册选择+拍照+多选 |
| 导出功能 | P3 | ✅ 完成 | 4h | 导出为 Markdown |
| 回收站 | P3 | ✅ 完成 | 4h | 软删除，可恢复 |
| 分享功能 | P3 | ✅ 完成 | 2h | 分享笔记内容 |
| 语音记录 | P3 | 🔄 待开发 | 10h | 录音并插入笔记 |
| 版本历史 | P3 | 🔄 待开发 | 6h | 记录修改历史 |

**小计：已完成主要功能，剩余约 16 小时**

---

### 2. 提醒模块 (优先级: P0-P3)

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 单次提醒 | P0 | ✅ 完成 | - | 设定具体时间提醒 |
| 提醒列表 | P0 | ✅ 完成 | - | 展示所有提醒 |
| 本地推送 | P0 | ✅ 完成 | - | flutter_local_notifications |
| 每日重复 | P1 | ✅ 完成 | - | 每天同一时间 |
| 每周重复 | P1 | ✅ 完成 | - | 选定星期几 |
| 完成标记 | P1 | ✅ 完成 | - | 勾选完成 |
| 早安推送 | P2 | 🔄 待开发 | 5h | 汇总今日计划+待办 |
| 习惯提醒 | P2 | 🔄 待开发 | 6h | 如"每天8点喝水" |
| 位置提醒 | P3 | 🔄 待开发 | 12h | 到达/离开某地触发 |
| 小组件 | P3 | 🔄 待开发 | 8h | 桌面小组件 |

**小计：已完成基础，剩余约 31 小时**

---

### 3. 运动追踪模块 (优先级: P0-P3)

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 手动记录 | P0 | ✅ 完成 | - | 选类型+时长+备注 |
| 运动历史 | P0 | ✅ 完成 | - | 展示所有记录 |
| 运动类型库 | P0 | ✅ 完成 | - | 20+运动类型 |
| 基础统计 | P1 | ✅ 完成 | - | 本周/本月次数 |
| GPS追踪 | P2 | 🔄 待开发 | 15h | 实时记录轨迹 |
| 卡路里计算 | P2 | 🔄 待开发 | 6h | 根据类型/时长估算 |
| 健康平台同步 | P2 | 🔄 待开发 | 20h | 小米/华为健康 |
| 数据可视化 | P2 | 🔄 待开发 | 8h | 趋势图、热力图 |
| 感受记录 | P3 | ✅ 完成 | - | 已集成到编辑页 |
| 配速计算 | P3 | 🔄 待开发 | 5h | 跑步/骑行配速 |

**小计：已完成基础，剩余约 54 小时**

---

### 4. 计划模块 (优先级: P0-P3)

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 创建计划 | P0 | ✅ 完成 | - | 目标名称+截止日期 |
| 任务分解 | P0 | ✅ 完成 | - | 手动添加子任务 |
| 每日清单 | P0 | ✅ 完成 | - | 每日待办视图 |
| 进度展示 | P0 | ✅ 完成 | - | 完成度百分比 |
| 自动打卡 | P1 | ✅ 完成 | - | 运动/笔记关联 |
| 日历视图 | P1 | 🔄 待开发 | 10h | 日历展示任务分布 |
| 模板库 | P2 | 🔄 待开发 | 8h | 预设计划模板 |
| AI生成计划 | P2 | 🔄 待开发 | 12h | 输入目标自动生成 |
| 甘特图 | P3 | 🔄 待开发 | 15h | 可视化时间线 |
| 里程碑 | P3 | 🔄 待开发 | 6h | 关键节点提醒 |

**小计：已完成基础，剩余约 51 小时**

---

### 5. AI教练核心模块 (新增) (优先级: P0-P2)

#### 5.1 用户画像采集

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 目标采集 | P0 | ✅ 完成 | - | 减脂/增肌/塑形/维持/提升体能 |
| 目标周期设置 | P0 | ✅ 完成 | - | 7天/30天/90天 |
| 目标体重/体脂率 | P0 | ✅ 完成 | - | 可选目标值 |
| 基础信息采集 | P0 | ✅ 完成 | - | 性别/年龄/身高/体重 |
| 体脂率录入 | P1 | ✅ 完成 | - | 选填 |
| 运动基础选择 | P0 | ✅ 完成 | - | 零基础/新手/有基础/资深 |
| 饮食禁忌/过敏 | P1 | ✅ 完成 | - | 多选标签 |
| 素食标识 | P1 | ✅ 完成 | - | 素食/蛋奶素/无 |
| 运动损伤记录 | P1 | ✅ 完成 | - | 可选损伤部位 |
| 可运动时间段 | P1 | ✅ 完成 | - | 时间段选择器 |
| 每日可运动时长 | P0 | ✅ 完成 | - | 分钟数输入 |
| 饮食口味偏好 | P2 | ✅ 完成 | - | 辣/清淡/酸甜等 |
| 喜欢的运动类型 | P2 | ✅ 完成 | - | 多选 |
| 讨厌的运动类型 | P2 | ✅ 完成 | - | 多选 |
| 器械情况 | P0 | ✅ 完成 | - | 无/家用小器械/健身房 |

**小计：已完成**

#### 5.2 训练计划生成

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 按日拆分计划 | P0 | ✅ 完成 | - | 匹配每日可运动时长 |
| 按周拆分计划 | P0 | ✅ 完成 | - | 周期性训练主题 |
| 每日训练主题 | P0 | ✅ 完成 | - | 如"胸肩训练"/"全身燃脂" |
| 动作详情生成 | P0 | ✅ 完成 | - | 名称+做法+组数+次数+休息 |
| 有无器械适配 | P0 | ✅ 完成 | - | 区分器械版本 |
| 难度适配 | P0 | ✅ 完成 | - | 适配运动基础 |
| 完整训练流程 | P0 | ✅ 完成 | - | 热身+主训练+拉伸 |
| 单个动作替换 | P1 | 🔄 待开发 | 6h | AI同步生成调整 |
| 训练时长估算 | P1 | ✅ 完成 | - | 明确标注时长 |
| 动作图示链接 | P2 | 🔄 待开发 | 8h | 图文/短视频示范 |

**小计：核心已完成**

#### 5.3 饮食计划生成

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 按日拆分饮食 | P0 | ✅ 完成 | - | 三餐+加餐 |
| 按周拆分饮食 | P0 | ✅ 完成 | - | 周期性菜单 |
| 热量目标计算 | P0 | ✅ 完成 | - | 减脂控缺口/增肌保蛋白 |
| 菜品详情生成 | P0 | ✅ 完成 | - | 食材+用量+做法 |
| 营养配比标注 | P1 | ✅ 完成 | - | 热量/蛋白/碳水/脂肪 |
| 食材替换方案 | P1 | 🔄 待开发 | 6h | 同营养值替换 |
| 禁忌适配 | P0 | ✅ 完成 | - | 满足饮食禁忌 |
| 偏好适配 | P1 | ✅ 完成 | - | 满足口味偏好 |
| 饮水建议 | P2 | 🔄 待开发 | 2h | 每日饮水量 |
| 进食时间建议 | P2 | 🔄 待开发 | 3h | 配合运动时间 |
| 食材采购清单 | P1 | ✅ 完成 | - | 按周生成采购清单 |

**小计：核心已完成**

#### 5.4 计划展示与操作

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 训练Tab页 | P0 | ✅ 完成 | - | 按日期罗列训练 |
| 饮食Tab页 | P0 | ✅ 完成 | - | 按日期罗列饮食 |
| 心率Tab页 | P1 | 🔄 待开发 | 5h | 实时心率数据展示 |
| 日/周视图切换 | P1 | 🔄 待开发 | 4h | 视图切换功能 |
| 关键信息突出 | P1 | ✅ 完成 | - | 组数/用量/时长加粗 |
| 计划收藏 | P2 | 🔄 待开发 | 4h | 收藏功能 |
| 计划截图 | P2 | 🔄 待开发 | 6h | 生成分享图片 |
| 计划分享 | P2 | 🔄 待开发 | 4h | 分享到社交平台 |
| 训练打卡 | P0 | ✅ 完成 | - | 训练完成打卡 |
| 饮食打卡 | P0 | ✅ 完成 | - | 饮食记录打卡 |
| 计划微调入口 | P1 | 🔄 待开发 | 5h | 替换动作/菜品 |

**小计：核心已完成**

#### 5.5 计划迭代优化

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 用户反馈入口 | P0 | 🔄 待开发 | 4h | 动作太难/食材买不到等 |
| AI一键重新生成 | P0 | 🔄 待开发 | 6h | 基于反馈调整计划 |
| 周期迭代提醒 | P1 | 🔄 待开发 | 4h | 每7/14天提醒更新 |
| 基于历史数据优化 | P1 | 🔄 待开发 | 8h | 执行率+心率数据分析 |
| 基于最新信息优化 | P1 | 🔄 待开发 | 6h | 结合最新身体数据 |

**小计：待开发**

**AI教练模块总计：核心功能已完成**

---

### 6. 心率监测模块 (新增) (优先级: P1-P2)

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 蓝牙权限申请 | P1 | 🔄 待开发 | 3h | Android BLE权限 |
| 心率带设备搜索 | P1 | 🔄 待开发 | 6h | 扫描BLE设备 |
| 设备配对功能 | P1 | 🔄 待开发 | 5h | 手动配对心率带 |
| Polar适配 | P1 | 🔄 待开发 | 4h | Polar心率带协议 |
| Garmin适配 | P1 | 🔄 待开发 | 4h | Garmin心率带协议 |
| Wahoo适配 | P1 | 🔄 待开发 | 4h | Wahoo心率带协议 |
| 华为手表适配 | P2 | 🔄 待开发 | 6h | 华为健康协议 |
| 小米手表适配 | P2 | 🔄 待开发 | 6h | 小米健康协议 |
| 实时心率采集 | P1 | 🔄 待开发 | 6h | 每秒更新 |
| 心率数值显示 | P1 | 🔄 待开发 | 3h | 当前心率数值 |
| 心率区间显示 | P1 | 🔄 待开发 | 5h | 热身/燃脂/有氧/无氧/极限 |
| 最大心率计算 | P1 | 🔄 待开发 | 2h | 220-年龄公式 |
| 目标区间设定 | P0 | 🔄 待开发 | 4h | 根据目标自动设定 |
| 区间阈值调整 | P2 | 🔄 待开发 | 3h | 手动调整阈值 |
| 心率曲线展示 | P1 | 🔄 待开发 | 6h | 实时曲线绘制 |
| 异常判断逻辑 | P1 | 🔄 待开发 | 5h | 30秒超限判断 |
| 异常提醒推送 | P1 | 🔄 待开发 | 4h | 弹窗/震动提醒 |
| 动态调整建议 | P1 | 🔄 待开发 | 8h | AI生成调整建议 |
| 心率数据存储 | P1 | 🔄 待开发 | 4h | 数据库表设计+存储 |
| 历史心率查询 | P2 | 🔄 待开发 | 4h | 关联训练计划存储 |
| 自动重连机制 | P1 | 🔄 待开发 | 5h | 10秒内自动重连 |

**小计：约 106 小时**

---

### 7. 数据层扩展 (新增表) (优先级: P0-P1)

| 数据库表 | 优先级 | 状态 | 工作量 | 说明 |
|---------|--------|------|--------|------|
| UserProfile | P0 | ✅ 完成 | - | 用户画像数据 |
| DietPlans | P0 | ✅ 完成 | - | 饮食计划表 |
| DietPlanMeals | P0 | ✅ 完成 | - | 饮食计划餐次详情 |
| MealItems | P0 | ✅ 完成 | - | 食材项 |
| WorkoutPlans | P0 | ✅ 完成 | - | AI训练计划 |
| WorkoutPlanDays | P0 | ✅ 完成 | - | 训练计划日程 |
| WorkoutPlanExercises | P0 | ✅ 完成 | - | 动作详情 |
| HeartRateRecords | P1 | 🔄 待开发 | 4h | 心率数据记录 |
| HeartRateZones | P1 | 🔄 待开发 | 2h | 心率区间配置 |
| DeviceInfo | P1 | 🔄 待开发 | 3h | 设备适配信息 |

**小计：AI教练表已完成**

---

### 8. 亮点功能 (优先级: P2-P3)

| 功能点 | 优先级 | 状态 | 工作量 | 说明 |
|--------|--------|------|--------|------|
| 游戏化系统 | P2 | ✅ 已完成 | 25h | 挑战+抽卡系统完成 |
| 每日/每周挑战 | P2 | ✅ 已完成 | 15h | 挑战任务+抽卡系统 |
| 智能天气适配 | P2 | 🔄 待开发 | 10h | 根据天气推荐运动 |
| 情绪分析 | P2 | ✅ 已完成 | 8h | 从笔记判断情绪→建议运动 |
| 睡眠简易联动 | P3 | 🔄 待开发 | 12h | 睡眠数据关联 |
| 语音交互 | P3 | 🔄 待开发 | 20h | 粤语/普通话新建记录 |
| 番茄专注+运动 | P3 | 🔄 待开发 | 10h | 工作休息结合 |
| 个性化主题 | P2 | ✅ 部分完成 | 5h | 扩展更多主题 |
| 动态小组件 | P3 | 🔄 待开发 | 12h | 桌面小组件 |
| 位置智能提醒 | P3 | 🔄 待开发 | 15h | 到公园自动建议运动 |
| 年度回忆视频 | P3 | 🔄 待开发 | 20h | 年度总结 |
| 年度热力图 | P3 | 🔄 待开发 | 10h | 运动热力图 |

**小计：约 162 小时**

---

## 🗓️ 分阶段实施计划

### 阶段9：AI教练核心功能 (P0优先级)

**目标**：实现基础AI教练功能，不含心率监测

| 子阶段 | 任务 | 工作量 | 依赖 |
|--------|------|--------|------|
| 9.1 | 数据库表设计 (UserProfile, WorkoutPlans等) | 8h | - |
| 9.2 | 用户画像采集页面 | 10h | 9.1 |
| 9.3 | AI训练计划生成接口 | 15h | 9.1, 9.2 |
| 9.4 | 训练计划展示页面 | 12h | 9.3 |
| 9.5 | 训练打卡功能 | 5h | 9.4 |
| 9.6 | AI饮食计划生成接口 | 15h | 9.1, 9.2 |
| 9.7 | 饮食计划展示页面 | 10h | 9.6 |
| 9.8 | 饮食打卡功能 | 5h | 9.7 |
| 9.9 | 计划微调功能 | 8h | 9.4, 9.7 |
| 9.10 | 用户反馈与迭代 | 10h | 9.9 |

**小计：约 98 小时 (2-3周)**

---

### 阶段10：心率监测功能 (P1优先级)

**目标**：实现蓝牙心率带连接与实时监测

| 子阶段 | 任务 | 工作量 | 依赖 |
|--------|------|--------|------|
| 10.1 | BLE权限申请与蓝牙框架搭建 | 8h | - |
| 10.2 | 心率带设备搜索与配对 | 12h | 10.1 |
| 10.3 | 主流心率带协议适配 (Polar/Garmin/Wahoo) | 15h | 10.2 |
| 10.4 | 实时心率数据采集 | 8h | 10.3 |
| 10.5 | 心率区间计算与显示 | 6h | 10.4 |
| 10.6 | 心率曲线实时绘制 | 8h | 10.4 |
| 10.7 | 异常判断与提醒 | 8h | 10.5 |
| 10.8 | AI动态调整建议 | 12h | 10.7 |
| 10.9 | 心率数据存储与历史查询 | 8h | 10.4 |
| 10.10 | 自动重连机制 | 6h | 10.3 |

**小计：约 91 小时 (2-3周)**

---

### 阶段11：高级功能完善 (P2优先级)

**目标**：完善现有模块的高级功能

| 子阶段 | 任务 | 工作量 | 依赖 |
|--------|------|--------|------|
| 11.1 | 记事本：搜索功能 | 3h | - |
| 11.2 | 记事本：富文本编辑 | 8h | - |
| 11.3 | 记事本：文件夹分类 | 6h | - |
| 11.4 | 提醒：习惯提醒 | 6h | - |
| 11.5 | 运动模块：GPS追踪 | 15h | - |
| 11.6 | 运动模块：数据可视化 | 8h | - |
| 11.7 | 计划模块：日历视图 | 10h | - |
| 11.8 | 游戏化系统基础 | 15h | - |
| 11.9 | 智能天气适配 | 10h | - |
| 11.10 | 情绪分析功能 | 8h | - |

**小计：约 89 小时 (2周)**

---

### 阶段12：终极功能 (P3优先级)

**目标**：锦上添花的高级功能

| 子阶段 | 任务 | 工作量 |
|--------|------|--------|
| 12.1 | 位置提醒 | 12h |
| 12.2 | 语音交互 | 20h |
| 12.3 | 动态小组件 | 12h |
| 12.4 | 年度回忆视频 | 20h |
| 12.5 | 番茄专注+运动 | 10h |
| 12.6 | 健康平台同步 | 20h |
| 12.7 | 配速计算 | 5h |
| 12.8 | 甘特图 | 15h |

**小计：约 114 小时**

---

## 📈 优先级推荐路线

### MVP版本 (最快可用) - 约 120 小时

```
阶段9.1-9.8: AI教练核心（不含迭代）
├── 用户画像采集
├── AI训练计划生成与展示
├── AI饮食计划生成与展示
└── 基础打卡功能
```

### 标准版本 (完整功能) - 约 280 小时

```
MVP (120h)
├── 阶段9.9-9.10: 计划迭代优化
├── 阶段11.1-11.7: 高级功能完善
└── 阶段11.8-11.9: 游戏化+天气适配
```

### 专业版本 (含心率监测) - 约 390 小时

```
标准版本 (280h)
├── 阶段10: 完整心率监测功能
└── 阶段11.10: 情绪分析
```

### 终极版本 (所有功能) - 约 500+ 小时

```
专业版本 (390h)
└── 阶段12: 所有P3功能
```

---

## 🔧 技术栈确认

| 组件 | 技术选择 | 版本 | 用途 |
|------|----------|------|------|
| 前端框架 | Flutter | 3.38.8 | 跨平台UI |
| 开发语言 | Dart | 3.10.7 | 应用逻辑 |
| 状态管理 | Riverpod | 2.6.1 | 状态管理 |
| 本地数据库 | Drift | 2.28.2 | SQLite ORM |
| 路由管理 | go_router | 14.8.1 | 类型安全路由 |
| 本地存储 | shared_preferences | 2.2+ | 键值存储 |
| 网络请求 | dio | 5.4+ | HTTP请求 |
| AI服务 | DeepSeek API | - | AI生成 |
| 图表 | fl_chart | 0.67+ | 数据可视化 |
| 蓝牙 | flutter_blue_plus | - | BLE心率带 |
| 地图 | flutter_map | - | GPS轨迹 |
| 推送 | flutter_local_notifications | 17.2+ | 本地推送 |
| 定位 | geolocator | 11.0+ | GPS定位 |
| 天气 | weather | - | 天气数据 |

---

## 📊 工作量汇总

| 模块 | 已完成 | 剩余 | 总计 |
|------|--------|------|------|
| 记事本模块 | ~29h | 35h | 64h |
| 提醒模块 | ~20h | 31h | 51h |
| 运动模块 | ~25h | 54h | 79h |
| 计划模块 | ~20h | 51h | 71h |
| AI教练模块 | ~98h | 60h | 158h |
| 心率监测模块 | 0h | 106h | 106h |
| 数据层扩展 | ~34h | 9h | 43h |
| 亮点功能 | ~5h | 157h | 162h |
| **总计** | **~231h** | **~503h** | **~734h** |

---

## 🎯 下一阶段行动

### 立即开始 (阶段9.1-9.3)

1. **数据库表设计** (8h)
   - UserProfile 表
   - WorkoutPlans 相关表
   - DietPlans 相关表

2. **用户画像采集页面** (10h)
   - 目标设置
   - 基础信息表单
   - 限制条件与偏好

3. **AI训练计划生成** (15h)
   - DeepSeek 提示词设计
   - 计划生成接口
   - 数据解析与存储

---

---

## 最新完成：游戏化系统 - 挑战与抽卡功能（2026-02-04）

### 每日/每周挑战系统

**核心功能**：
- 每日3个随机挑战，0点自动刷新
- 每周2个随机挑战，周一自动刷新
- 实时进度追踪与奖励领取
- 挑战类型覆盖：运动、笔记、计划、连续打卡、运动时长

**每日挑战池**：
- 运动达人：完成3次运动记录（20 EXP, 10积分）
- 健身入门：完成1次运动记录（10 EXP, 5积分）
- 运动时长挑战：累计运动30分钟（25 EXP, 15积分）
- 笔记高手：创建2条笔记（10 EXP, 5积分）
- 记录生活：创建1条笔记（5 EXP, 3积分）
- 计划执行者：完成2个计划任务（15 EXP, 8积分）
- 任务达人：完成1个计划任务（8 EXP, 4积分）

**每周挑战池**：
- 周运动冠军：本周累计运动5次（100 EXP, 50积分）
- 运动健将：本周累计运动3次（60 EXP, 30积分）
- 周时长挑战：本周累计运动150分钟（120 EXP, 60积分）
- 连续打卡王：连续7天有活动记录（150 EXP, 80积分）
- 笔记达人：本周创建10条笔记（80 EXP, 40积分）
- 计划执行专家：本周完成10个计划任务（100 EXP, 50积分）

### 幸运抽卡系统

**核心功能**：
- 免费抽卡：每日1次免费机会
- 单抽：消耗50积分
- 十连抽：消耗450积分（优惠50积分）

**稀有度概率**：
- 普通物品 (60%) - 灰色
- 稀有物品 (30%) - 蓝色
- 史诗物品 (8%) - 紫色
- 传说物品 (2%) - 橙色

**保底机制**：
- 10抽必出稀有以上物品
- 50抽必出史诗以上物品
- 100抽必出传说物品

**物品类型**：
- 称号 (title)：早起鸟、夜猫子、健身爱好者、运动健将、传奇大师等
- 主题 (theme)：深蓝主题、极光主题、星空主题等
- 徽章 (badge)：青铜徽章、白银徽章、黄金徽章、钻石徽章等

### 新增文件

**挑战系统**：
- `lib/services/challenge/challenge_service.dart` - 挑战服务核心逻辑
- `lib/features/challenge/presentation/providers/challenge_providers.dart` - 状态管理
- `lib/features/challenge/presentation/widgets/challenge_card.dart` - 挑战卡片组件
- `lib/features/challenge/presentation/pages/challenges_page.dart` - 挑战页面

**抽卡系统**：
- `lib/services/gacha/gacha_service.dart` - 抽卡服务核心逻辑
- `lib/features/gacha/presentation/providers/gacha_providers.dart` - 状态管理
- `lib/features/gacha/presentation/widgets/gacha_animation.dart` - 抽卡动画组件
- `lib/features/gacha/presentation/pages/gacha_page.dart` - 抽卡页面

### 首页集成

在游戏化区域新增两个快捷入口：
- **每日挑战**：使用warningGradient渐变，点击跳转到挑战页面
- **幸运抽卡**：使用secondaryGradient渐变，点击跳转到抽卡页面

---

## 📊 项目全面分析报告（2026-02-05）

### 8智能体并行分析结果

使用8个并行Explore智能体对整个项目进行全面分析，以下是各模块详细完成度：

### 架构基础设施 (95%)

| 组件 | 状态 | 说明 |
|------|------|------|
| 路由配置 | ✅ 完整 | 38个路由，覆盖所有功能 |
| Provider配置 | ✅ 完整 | 13个仓库 + 11个服务 |
| 数据库设计 | ✅ 优秀 | 24个表，索引优化 |
| 主题系统 | ✅ 完整 | 渐变色 + 明暗主题 |
| 共享组件 | ✅ 完善 | 现代化组件库 |

### 记事本模块 (75%)

**已完成:**
- ✅ P0: 基础CRUD、笔记列表、标签系统
- ✅ P1: 按标签筛选、搜索功能
- ✅ P2: 文件夹分类、Markdown编辑
- ✅ P3: 回收站、置顶功能

**待完善:**
- ❌ 图片插入功能
- ❌ 富文本编辑器升级
- ❌ 导出功能（PDF/MD）
- ❌ 语音记录

### 提醒模块 (50%)

**已完成:**
- ✅ P0/P1: 单次提醒、重复提醒、本地推送、完成标记

**待完善:**
- ❌ **底部导航入口缺失**（用户无法直接访问！）
- ❌ P2: 早安推送、习惯提醒
- ❌ P3: 位置提醒、小组件

### 运动模块 (95%)

**已完成:**
- ✅ P0: 手动记录、运动历史、28种运动类型
- ✅ P1: 基础统计
- ✅ P2: GPS追踪、卡路里计算、数据可视化
- ✅ P3: 感受记录、配速计算

**待完善:**
- ⚠️ GPS轨迹回放优化

### 计划模块 (70%)

**已完成:**
- ✅ P0: 创建计划、任务分解、每日清单、进度展示
- ✅ P1: 自动打卡、日历视图

**待完善:**
- ❌ P2: 模板库、AI生成计划集成
- ❌ P3: 甘特图、里程碑

### AI教练模块 (95%)

**已完成:**
- ✅ 用户画像采集
- ✅ 训练计划生成
- ✅ 饮食计划生成
- ✅ 计划展示与操作
- ✅ 计划迭代优化
- ✅ DeepSeek服务集成

**待完善:**
- ⚠️ UI美观度提升
- ⚠️ 数据可视化增强

### 心率监测模块 (90%)

**已完成:**
- ✅ BLE蓝牙连接与权限申请
- ✅ 实时心率采集与显示
- ✅ 心率区间判断（5个可自定义区间）
- ✅ 心率曲线实时绘制
- ✅ 数据存储与历史查询

**待完善:**
- ❌ 心率异常阈值提醒
- ❌ 心率变异性（HRV）分析
- ❌ 数据导出功能

### 亮点功能状态

| 功能 | 完成度 | 说明 |
|------|--------|------|
| 游戏化系统 | 95% | 等级/积分/成就系统完整 |
| 挑战系统 | 85% | 框架完成，需具体挑战类型定义 |
| 抽卡系统 | 80% | 框架完成，需概率算法和物品池 |
| 情绪分析 | 75% | 数据层完成，算法需完善 |
| 天气适配 | 95% | API集成完成，地理编码+缓存完善 |
| 语音功能 | 65% | UI完成，服务层未实现 |

### 代码质量评估

| 评估项 | 评分 | 说明 |
|--------|------|------|
| 架构设计 | ⭐⭐⭐⭐⭐ | Clean Architecture清晰 |
| 代码组织 | ⭐⭐⭐⭐⭐ | 分层明确，模块化 |
| 状态管理 | ⭐⭐⭐⭐⭐ | Riverpod使用规范 |
| 数据库设计 | ⭐⭐⭐⭐⭐ | 24个表，索引优化 |
| UI/UX设计 | ⭐⭐⭐⭐ | 现代化渐变风格 |
| 错误处理 | ⭐⭐⭐⭐ | 统一异常处理机制 |

### 关键问题与建议

#### 🔴 优先级高（需立即处理）

1. **提醒模块导航入口缺失**
   - 提醒功能代码完整，但底部导航没有入口
   - 预计修复时间：1小时

2. **语音功能服务层未实现**
   - UI已完成，但核心识别/合成服务缺失
   - 预计完成时间：12小时

3. **天气API集成完成** ✅
   - 已集成 Open-Meteo 免费天气API
   - 已集成 Nominatim 地理编码API
   - 已实现位置名称缓存机制
   - 并行获取天气+空气质量数据

#### 🟡 优先级中（建议完善）

4. **抽卡系统物品池定义**
   - 需要定义具体的抽卡物品池
   - 实现概率算法和保底机制
   - 预计完成时间：4小时

5. **挑战系统具体类型**
   - 需要定义具体的挑战任务
   - 实现奖励发放逻辑
   - 预计完成时间：4小时

6. **计划模块模板库**
   - 预设计划模板
   - 模板选择UI
   - 预计完成时间：8小时

#### 🟢 优先级低（可选）

7. 富文本编辑器升级
8. 图片插入功能
9. 数据导出功能
10. 甘特图可视化

### 总体评估

项目整体进度约 **80%**，核心功能基本完成，代码质量优秀。主要剩余工作集中在：
1. 修复导航入口等小问题
2. 完善游戏化系统的具体内容
3. 集成外部API（天气、语音）
4. 实现高级可视化功能

---

---

## 天气API集成完成（2026-02-05）

### 功能概述
完成了天气模块的API集成，使用完全免费的第三方服务实现智能运动推荐功能。

### 使用的免费API

| API | 用途 | 免费额度 |
|-----|------|----------|
| **Open-Meteo** | 天气数据（温度、湿度、风速、天气状况） | 完全免费，无需API Key |
| **Open-Meteo Air Quality** | 空气质量指数(AQI) | 完全免费，无需API Key |
| **Nominatim (OpenStreetMap)** | 地理编码（经纬度转位置名称） | 完全免费，无需API Key |

### 新增功能

1. **地理编码服务**
   - 使用 Nominatim API 将经纬度转换为可读的位置名称
   - 支持中文地址解析（如：北京市朝阳区）
   - 智能提取位置主要部分，过滤邮政编码等无效信息

2. **位置名称缓存**
   - 24小时缓存有效期（位置变化不频繁）
   - 5公里 proximity 阈值判断是否重新获取
   - 持久化存储到 SharedPreferences

3. **并行数据获取**
   - 天气数据和空气质量并行获取
   - 提高响应速度，减少等待时间

4. **运动推荐逻辑**
   - 根据天气状况（晴/雨/雪/雾等）推荐户外/室内运动
   - 根据温度推荐合适的运动类型
   - 考虑空气质量、风速等因素
   - 提供运动时长、强度、时间段、装备建议

### 天气推荐规则

| 条件 | 推荐场景 | 推荐运动 |
|------|----------|----------|
| 晴天 18-28°C | 户外 | 跑步、骑行、户外徒步、篮球、足球、网球 |
| 多云 | 户外 | 跑步、骑行、户外徒步、羽毛球、户外健身 |
| 降水天气 | 室内 | 跑步机、室内瑜伽、力量训练、跳绳、游泳 |
| 高温(>30°C) | 室内/早晚 | 游泳、室内瑜伽、健身房训练、早晚散步 |
| 低温(<10°C) | 室内 | 室内跑步、力量训练、室内瑜伽、跳绳 |
| 空气质量差(AQI>100) | 室内 | 跑步机、室内瑜伽、力量训练、游泳 |

### 修改文件
- `lib/services/weather/weather_service.dart` - 添加地理编码、位置缓存、并行获取

---

*文档最后更新：2026-02-05*

