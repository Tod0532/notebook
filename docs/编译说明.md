# åŠ¨è®¡ç¬”è®° - ç¼–è¯‘è¯´æ˜

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶
| è½¯ä»¶ | ç‰ˆæœ¬ | ä¸‹è½½åœ°å€ |
|------|------|----------|
| Flutter SDK | 3.38.8+ | https://flutter.dev/docs/get-started/install |
| Dart | 3.10.7+ | éš Flutter è‡ªåŠ¨å®‰è£… |
| Android Studio | æœ€æ–°ç‰ˆ | https://developer.android.com/studio |

### ç¯å¢ƒå˜é‡
```bash
# Flutter è·¯å¾„ï¼ˆæ ¹æ®å®é™…å®‰è£…ä½ç½®è°ƒæ•´ï¼‰
FLUTTER_ROOT=G:\8.CC\flutter
# æˆ–è€…åœ¨ç³»ç»Ÿ PATH ä¸­æ·»åŠ ï¼š%FLUTTER_ROOT%\bin
```

### éªŒè¯ç¯å¢ƒ
```bash
flutter doctor
```

é¢„æœŸè¾“å‡ºï¼š
```
[âœ“] Flutter (Channel stable, 3.38.8)
[âœ“] Android toolchain - develop for Android devices
[âœ“] Android Studio (version 202X.X)
[âœ“] Connected device (available)
```

---

## é¦–æ¬¡ç¼–è¯‘æ­¥éª¤

### 1. è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd G:\8.CC\ThickNotepad
```

### 2. è·å–ä¾èµ–
```bash
flutter pub get
```

### 3. ç”Ÿæˆæ•°æ®åº“ä»£ç ï¼ˆé‡è¦ï¼ï¼‰
```bash
dart run build_runner build --delete-conflicting-outputs
```

### 4. éªŒè¯ç¼–è¯‘
```bash
flutter analyze
```

åº”è¯¥çœ‹åˆ°ï¼š`No issues found!` æˆ–åªæœ‰ info çº§åˆ«æç¤º

### 5. è¿è¡Œåº”ç”¨
```bash
# è¿æ¥ Android è®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨å
flutter run
```

---

## ç¼–è¯‘è·¯å¾„ï¼ˆå½“å‰ç¯å¢ƒï¼‰

### Flutter SDK è·¯å¾„
```
G:\8.CC\flutter
```

### Flutter å¯æ‰§è¡Œæ–‡ä»¶
```
G:\8.CC\flutter\bin\flutter.bat
```

### é¡¹ç›®è·¯å¾„
```
G:\8.CC\ThickNotepad
```

### APK è¾“å‡ºè·¯å¾„
```
G:\8.CC\ThickNotepad\build\app\outputs\flutter-apk\app-debug.apk
```

---

## Windows PowerShell ç¼–è¯‘å‘½ä»¤

å¦‚æœ Flutter æœªæ·»åŠ åˆ°ç³»ç»Ÿ PATHï¼Œä½¿ç”¨å®Œæ•´è·¯å¾„ï¼š

```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•
cd 'G:\8.CC\ThickNotepad'

# è·å–ä¾èµ–
& 'G:\8.CC\flutter\bin\flutter.bat' pub get

# ç”Ÿæˆæ•°æ®åº“ä»£ç 
& 'G:\8.CC\flutter\bin\flutter.bat' pub run build_runner build --delete-conflicting-outputs

# ä»£ç åˆ†æ
& 'G:\8.CC\flutter\bin\flutter.bat' analyze

# æ„å»º Debug APK
& 'G:\8.CC\flutter\bin\flutter.bat' build apk --debug

# çœŸæœºè¿è¡Œï¼ˆéœ€è¦è¿æ¥è®¾å¤‡å¹¶è·å–è®¾å¤‡IDï¼‰
& 'G:\8.CC\flutter\bin\flutter.bat' run -d <è®¾å¤‡ID>

# ç¤ºä¾‹ï¼šSeeker è®¾å¤‡
& 'G:\8.CC\flutter\bin\flutter.bat' run -d SM02G4061983569
```

---

## çœŸæœºè¿è¡Œæ­¥éª¤

### 1. å¯ç”¨ USB è°ƒè¯•
1. æ‰‹æœºè¿›å…¥ã€Œè®¾ç½®ã€â†’ã€Œå¼€å‘è€…é€‰é¡¹ã€
2. å¼€å¯ã€ŒUSB è°ƒè¯•ã€
3. ç”¨ USB æ•°æ®çº¿è¿æ¥æ‰‹æœºå’Œç”µè„‘

### 2. æˆæƒè°ƒè¯•
- æ‰‹æœºä¸Šä¼šå¼¹å‡ºã€Œå…è®¸ USB è°ƒè¯•ã€æç¤º
- ç‚¹å‡»ã€Œå…è®¸ã€å¹¶å‹¾é€‰ã€Œå§‹ç»ˆå…è®¸ã€

### 3. æ£€æŸ¥è®¾å¤‡è¿æ¥
```powershell
& 'G:\8.CC\flutter\bin\flutter.bat' devices
```

é¢„æœŸè¾“å‡ºï¼š
```
Found 3 connected devices:
  Seeker â€¢ SM02G4061983569 â€¢ android-arm64  â€¢ Android 15 (API 35)
  Windows â€¢ windows            â€¢ windows-x64    â€¢ Microsoft Windows
  Chrome  â€¢ chrome              â€¢ web-javascript â€¢ Google Chrome
```

### 4. è¿è¡Œåº”ç”¨
```powershell
cd 'G:\8.CC\ThickNotepad'
& 'G:\8.CC\flutter\bin\flutter.bat' run -d SM02G4061983569
```

---

## ç¼–è¯‘ç»“æœå‚è€ƒ

| é¡¹ç›® | å€¼ |
|------|-----|
| ç¼–è¯‘çŠ¶æ€ | âœ… æˆåŠŸ |
| APK å¤§å° | çº¦ 150 MB |
| è¾“å‡ºè·¯å¾„ | `build\app\outputs\flutter-apk\app-debug.apk` |
| æµ‹è¯•è®¾å¤‡ | Seeker (SM02G4061983569) |
| è®¾å¤‡åˆ†è¾¨ç‡ | 1200Ã—2670 |
| æ¸²æŸ“åç«¯ | Impeller (Vulkan) |

---

## ç¼–è¯‘å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | ç”¨é€” |
|------|------|
| `flutter pub get` | å®‰è£…/æ›´æ–°ä¾èµ– |
| `dart run build_runner build` | ç”Ÿæˆæ•°æ®åº“ä»£ç  |
| `flutter analyze` | ä»£ç é™æ€åˆ†æ |
| `flutter run` | è°ƒè¯•è¿è¡Œ |
| `flutter run --release` | å‘å¸ƒæ¨¡å¼è¿è¡Œ |
| `flutter build apk --debug` | æ„å»º Debug APK |
| `flutter build apk --release` | æ„å»º Release APK |
| `flutter clean` | æ¸…ç†æ„å»ºç¼“å­˜ |
| `flutter pub upgrade` | å‡çº§ä¾èµ–åŒ… |

---

## å·²çŸ¥é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šæ•°æ®åº“ä»£ç æœªç”Ÿæˆ

**ç—‡çŠ¶**ï¼š
```
error - Undefined class 'NotesCompanion'
error - Undefined class 'RemindersCompanion'
```

**åŸå› **ï¼šä¿®æ”¹æ•°æ®åº“åæœªé‡æ–°ç”Ÿæˆä»£ç 

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
dart run build_runner build --delete-conflicting-outputs
```

---

### é—®é¢˜ 2ï¼šDrift Column ç±»å‹å†²çª

**ç—‡çŠ¶**ï¼š
```
error - Ambiguous import: 'Column' is imported from both 'package:flutter/material.dart' and 'package:drift/drift.dart'
```

**åŸå› **ï¼šFlutter å’Œ Drift éƒ½å¯¼å‡ºäº† `Column` ç±»

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ Repository æ–‡ä»¶ä¸­ä½¿ç”¨ drift å‰ç¼€
```dart
import 'package:drift/drift.dart' as drift;

// ä½¿ç”¨æ—¶
..orderBy([(tbl) => drift.OrderingTerm.desc(tbl.createdAt)])
```

---

### é—®é¢˜ 3ï¼šCompanion ç±»åä¸åŒ¹é…

**ç—‡çŠ¶**ï¼š
```
error - Undefined class 'NoteCompanion'
```

**åŸå› **ï¼šDrift ç”Ÿæˆçš„ç±»åå¸¦ `s` åç¼€ï¼ˆNotesCompanionï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨æ­£ç¡®çš„ç±»å
| æœŸæœ›ç±»å | å®é™…ç±»å |
|----------|----------|
| NoteCompanion | NotesCompanion |
| ReminderCompanion | RemindersCompanion |
| WorkoutCompanion | WorkoutsCompanion |
| PlanTaskCompanion | PlanTasksCompanion |

---

### é—®é¢˜ 4ï¼šValue ç±»å‹å¼•ç”¨é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
error - The argument type 'String?' can't be assigned to the parameter type 'Value<String?>'
```

**åŸå› **ï¼šDrift çš„ Value éœ€è¦ä½¿ç”¨ drift.Value

**è§£å†³æ–¹æ¡ˆ**ï¼š
```dart
import 'package:drift/drift.dart' as drift;

// ä½¿ç”¨æ—¶
NotesCompanion.insert(
  title: drift.Value(title.isEmpty ? null : title),
  content: content,
  tags: drift.Value(tagsJson),
)
```

---

### é—®é¢˜ 5ï¼šisNotInValues æ–¹æ³•ä¸å­˜åœ¨

**ç—‡çŠ¶**ï¼š
```
error - The method 'isNotInValues()' isn't defined for the type
```

**åŸå› **ï¼šDrift çš„æ–¹æ³•æ˜¯ `isNotIn` ä¸æ˜¯ `isNotInValues`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```dart
// é”™è¯¯
tbl.repeatType.isNotInValues(['none'])

// æ­£ç¡®
tbl.repeatType.isNotIn(['none'])
```

---

### é—®é¢˜ 6ï¼šGradle æ„å»ºå¤±è´¥

**ç—‡çŠ¶**ï¼š
```
[!] Your app is using an unsupported Gradle project
```

**åŸå› **ï¼šåŸç”Ÿé¡¹ç›®æ–‡ä»¶æœªæ­£ç¡®åˆå§‹åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
cd G:\8.CC\ThickNotepad
flutter create --org com.thicknotepad --project-name thick_notepad .
```

---

### é—®é¢˜ 7ï¼šçƒ­é‡è½½ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**ï¼šä¿®æ”¹ä»£ç åçƒ­é‡è½½æ— ååº”

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å…ˆå°è¯•çƒ­é‡å¯ï¼šåœ¨ç»ˆç«¯æŒ‰ `R`
2. å¦‚æœè¿˜ä¸è¡Œï¼Œå®Œå…¨é‡å¯ï¼šæŒ‰ `q` é€€å‡ºåé‡æ–° `flutter run`
3. ä¿®æ”¹æ•°æ®åº“æˆ–æ·»åŠ æ–°æ–‡ä»¶æ—¶å¿…é¡»å®Œå…¨é‡å¯

---

### é—®é¢˜ 8ï¼šWindows å¼€å‘è€…æ¨¡å¼æœªå¯ç”¨ âš ï¸

**ç—‡çŠ¶**ï¼š
```
Building with plugins requires symlink support.
Please enable Developer Mode in your system settings.
```

**åŸå› **ï¼šFlutter æ’ä»¶éœ€è¦ç¬¦å·é“¾æ¥æ”¯æŒï¼ŒWindows éœ€è¦å¯ç”¨å¼€å‘è€…æ¨¡å¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æŒ‰ `Win + R`
2. è¾“å…¥ `ms-settings:developers`
3. å¼€å¯ **å¼€å‘è€…æ¨¡å¼**
4. é‡æ–°è¿è¡Œ `flutter run`

---

### é—®é¢˜ 9ï¼šCore Library Desugaring é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
Dependency ':flutter_local_notifications' requires core library desugaring to be enabled
```

**åŸå› **ï¼š`flutter_local_notifications` éœ€è¦ desugaring æ”¯æŒ

**è§£å†³æ–¹æ¡ˆ**ï¼šä¿®æ”¹ `android/app/build.gradle.kts`
```kotlin
compileOptions {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
    isCoreLibraryDesugaringEnabled = true  // æ·»åŠ è¿™è¡Œ
}

dependencies {
    coreLibraryDesugaring("com.android.tools:desugar_jdk_libs:2.0.4")
}
```

---

### é—®é¢˜ 10ï¼šç½‘ç»œè¿æ¥å¤±è´¥ï¼ˆå›½å†…ç¯å¢ƒï¼‰

**ç—‡çŠ¶**ï¼š
```
Could not GET 'https://storage.googleapis.com/...'
Connection reset
```

**åŸå› **ï¼šæ— æ³•è®¿é—® Google æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ**ï¼šé…ç½®é˜¿é‡Œäº‘é•œåƒæºï¼Œä¿®æ”¹ `android/build.gradle.kts`
```kotlin
allprojects {
    repositories {
        maven { url = uri("https://maven.aliyun.com/repository/google") }
        maven { url = uri("https://maven.aliyun.com/repository/public") }
        maven { url = uri("https://maven.aliyun.com/repository/gradle-plugin") }
        google()
        mavenCentral()
    }
}
```

---

### é—®é¢˜ 11ï¼šWeb æ„å»ºå¤±è´¥ï¼ˆsqlite3 ä¸æ”¯æŒï¼‰

**ç—‡çŠ¶**ï¼š
```
error - Only JS interop members may be 'external'
```

**åŸå› **ï¼š`sqlite3` åŒ…ä½¿ç”¨ FFI è°ƒç”¨åŸç”Ÿä»£ç ï¼ŒWeb ç¯å¢ƒä¸æ”¯æŒ

**è§£å†³æ–¹æ¡ˆ**ï¼šWeb ç‰ˆæœ¬ä¸æ”¯æŒæ­¤åº”ç”¨ï¼Œè¯·ä½¿ç”¨ Android æˆ– Windows æ¡Œé¢ç‰ˆ

---

### é—®é¢˜ 12ï¼šKotlin ç¼“å­˜å†²çª

**ç—‡çŠ¶**ï¼š
```
IllegalArgumentException: this and base files have different roots
```

**åŸå› **ï¼šKotlin å¢é‡ç¼–è¯‘ç¼“å­˜å†²çª

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†æ‰€æœ‰ç¼“å­˜
flutter clean
rm -rf android/.gradle
rm -rf android/app/build

# é‡æ–°æ„å»º
flutter run
```

---

### é—®é¢˜ 13ï¼šRiverpod Provider ä½¿ç”¨é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
error - The getter 'notifier' isn't defined for the type 'AutoDisposeProvider<T>'
```

**åŸå› **ï¼šç›´æ¥ä½¿ç”¨ Provider è€Œé StateNotifierProvider æ—¶æ²¡æœ‰ notifier

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨æ­£ç¡®çš„ Provider ç±»å‹æˆ–ç›´æ¥è®¿é—® Repository
```dart
// é”™è¯¯
final notifier = ref.watch(updateReminderProvider.notifier);

// æ­£ç¡® - ç›´æ¥ä½¿ç”¨ Repository
final repo = ref.read(reminderRepositoryProvider);
repo.createReminder(reminder);
```

---

### é—®é¢˜ 14ï¼šæ•°æ®åº“ç´¢å¼•è¯­æ³•ä¸å…¼å®¹ âš ï¸

**ç—‡çŠ¶**ï¼š
```
error - Too few positional arguments: 2 required, 1 given
```

**åŸå› **ï¼šDrift 2.28 ä¸æ”¯æŒåœ¨ Table ç±»ä¸­å†…è”å®šä¹‰ç´¢å¼•

**è§£å†³æ–¹æ¡ˆ**ï¼šç§»é™¤æ‰€æœ‰è¡¨å®šä¹‰ä¸­çš„ `late final Index` å£°æ˜

```dart
// âŒ é”™è¯¯ - Drift 2.28 ä¸æ”¯æŒ
class Notes extends Table {
  IntColumn get id => integer().autoIncrement()();
  TextColumn get title => text().nullable()();

  late final Index updatedAtIndex = Index([updatedAt]);  // ç¼–è¯‘é”™è¯¯
}

// âœ… æ­£ç¡® - ç§»é™¤ç´¢å¼•å®šä¹‰
class Notes extends Table {
  IntColumn get id => integer().autoIncrement()();
  TextColumn get title => text().nullable()();
  // å¦‚éœ€ç´¢å¼•ï¼Œåœ¨æ•°æ®åº“åˆå§‹åŒ–æ—¶é€šè¿‡ SQL åˆ›å»º
}
```

**å½±å“èŒƒå›´**ï¼šæ‰€æœ‰æ•°æ®è¡¨ï¼ˆNotesã€Remindersã€Workoutsã€Plansã€PlanTasksï¼‰

---

### é—®é¢˜ 15ï¼šWidgetRef ä¸ Ref ç±»å‹ä¸åŒ¹é…

**ç—‡çŠ¶**ï¼š
```
error - The argument type 'WidgetRef' can't be assigned to the parameter type 'Ref<Object?>'
```

**åŸå› **ï¼šåœ¨ Riverpod 2.6.1 ä¸­ï¼ŒWidgetRef å’Œ Ref æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä¸èƒ½äº’ç›¸èµ‹å€¼

**è§£å†³æ–¹æ¡ˆ**ï¼šä¸º WidgetRef å’Œ Ref åˆ†åˆ«åˆ›å»ºé‡è½½æ–¹æ³•

```dart
// âŒ é”™è¯¯ - æ··ç”¨ç±»å‹
class ProviderInvalidator {
  static void invalidateNotes(Ref ref) {  // åªæ¥å— Ref
    ref.invalidate(allNotesProvider);
  }
}

// åœ¨ Widget ä¸­è°ƒç”¨ä¼šæŠ¥é”™
ref.invalidate(allNotesProvider);  // WidgetRef ä¸èƒ½ä¼ ç»™ Ref å‚æ•°

// âœ… æ­£ç¡® - æ–¹æ³•é‡è½½
class ProviderInvalidator {
  // WidgetRef ç‰ˆæœ¬ï¼ˆåœ¨ Widget ä¸­ä½¿ç”¨ï¼‰
  static void invalidateNotes(WidgetRef ref) {
    ref.invalidate(allNotesProvider);
    ref.invalidate(pinnedNotesProvider);
  }

  // Ref ç‰ˆæœ¬ï¼ˆåœ¨ Provider ä¸­ä½¿ç”¨ï¼‰
  static void invalidateNotesRef(Ref ref) {
    ref.invalidate(allNotesProvider);
    ref.invalidate(pinnedNotesProvider);
  }
}
```

---

### é—®é¢˜ 16ï¼šCompanion å‚æ•°éœ€è¦ drift.Value åŒ…è£…

**ç—‡çŠ¶**ï¼š
```
error - The argument type 'String' can't be assigned to the parameter type 'Value<String?>'
```

**åŸå› **ï¼šDrift Companion ç±»çš„å¯é€‰å­—æ®µéœ€è¦ä½¿ç”¨ `drift.Value` åŒ…è£…

**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ drift å¯¼å…¥å¹¶ä½¿ç”¨ drift.Value

```dart
import 'package:drift/drift.dart' as drift;

// âŒ é”™è¯¯ - ç›´æ¥ä¼  String
NotesCompanion.insert(
  title: title,        // String ä¸èƒ½ç›´æ¥èµ‹å€¼ç»™ Value<String?>
  content: content,
)

// âœ… æ­£ç¡® - ä½¿ç”¨ drift.Value åŒ…è£…
NotesCompanion.insert(
  title: drift.Value(title),
  content: content,
)
```

**æ³¨æ„**ï¼šéå¯é€‰å­—æ®µï¼ˆå¦‚ `text()`ï¼‰ä¸éœ€è¦åŒ…è£…ï¼Œåªæœ‰ `nullable()` å­—æ®µéœ€è¦

---

### é—®é¢˜ 17ï¼šå¼•ç”¨äº†ä¸å­˜åœ¨çš„ Provider

**ç—‡çŠ¶**ï¼š
```
error - Undefined name 'recentNotesProvider'
```

**åŸå› **ï¼šä»£ç ä¸­å¼•ç”¨äº†æœªå®šä¹‰çš„ Provider

**è§£å†³æ–¹æ¡ˆ**ï¼šç§»é™¤å¯¹ä¸å­˜åœ¨ Provider çš„å¼•ç”¨

```dart
// âŒ é”™è¯¯
static void invalidateNotes(WidgetRef ref) {
  ref.invalidate(allNotesProvider);
  ref.invalidate(recentNotesProvider);  // ä¸å­˜åœ¨
}

// âœ… æ­£ç¡®
static void invalidateNotes(WidgetRef ref) {
  ref.invalidate(allNotesProvider);
  ref.invalidate(pinnedNotesProvider);  // ä½¿ç”¨å­˜åœ¨çš„ Provider
}
```

---

### é—®é¢˜ 18ï¼šè¿è¡Œæ—¶ RangeErrorï¼ˆåˆ—è¡¨ç´¢å¼•è¶Šç•Œï¼‰

**ç—‡çŠ¶**ï¼š
```
RangeError (length): Invalid value: Valid value range is empty: -1
```

**åŸå› **ï¼šåˆ—è¡¨ç´¢å¼•è®¡ç®—é”™è¯¯ï¼Œå½“åªæœ‰ç½®é¡¶ç¬”è®°æ—¶è®¡ç®—å‡º -1

**ä½ç½®**ï¼š`lib/features/notes/presentation/pages/notes_page.dart`

**è§£å†³æ–¹æ¡ˆ**ï¼šæ­£ç¡®å¤„ç†åˆ†éš”ç¬¦åç§»é‡

```dart
// âŒ é”™è¯¯ - å›ºå®šåŠ  1
final note = isPinned
    ? pinnedNotes[index]
    : normalNotes[index - pinnedNotes.length - 1];  // æœ‰æ—¶æ˜¯ -1

// âœ… æ­£ç¡® - åŠ¨æ€è®¡ç®—åç§»
final hasSeparator = pinnedNotes.isNotEmpty && normalNotes.isNotEmpty;
final separatorOffset = hasSeparator ? 1 : 0;

final note = isPinned
    ? pinnedNotes[index]
    : normalNotes[index - pinnedNotes.length - separatorOffset];
```

---

### é—®é¢˜ 19ï¼šLocaleDataExceptionï¼ˆintl æœªåˆå§‹åŒ–ï¼‰

**ç—‡çŠ¶**ï¼š
```
LocaleDataException: Locale data has not been initialized
call initializeDateFormatting(<locale>) before using DateFormat
```

**åŸå› **ï¼šä½¿ç”¨ intl çš„ DateFormat å‰æœªåˆå§‹åŒ–

**ä½ç½®**ï¼š`lib/main.dart`

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ main å‡½æ•°ä¸­åˆå§‹åŒ– intl

```dart
import 'package:intl/intl.dart';
import 'package:intl/date_symbol_data_local.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  // âœ… æ·»åŠ è¿™è¡Œ - åˆå§‹åŒ–ä¸­æ–‡æ—¥æœŸæ ¼å¼
  await initializeDateFormatting('zh_CN', null);

  runApp(
    const ProviderScope(
      child: ThickNotepadApp(),
    ),
  );
}
```

---

### é—®é¢˜ 20ï¼šTextEditingController å†…å­˜æ³„æ¼

**ç—‡çŠ¶**ï¼šåœ¨å¼€å‘è€…å·¥å…·ä¸­è§‚å¯Ÿåˆ°æœªé‡Šæ”¾çš„ TextEditingController

**åŸå› **ï¼šShowDialog è¿”å›å‰æœª dispose controller

**ä½ç½®**ï¼š`lib/shared/widgets/error_display.dart`

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ await ç¡®ä¿ dispose æ‰§è¡Œ

```dart
// âŒ é”™è¯¯ - è¿”å› Future ä½†æ²¡æœ‰ await
static Future<String?> input(BuildContext context, {...}) {
  final controller = TextEditingController(text: initialValue);
  return showDialog<String>(...);
  // controller.dispose() æ°¸è¿œä¸ä¼šæ‰§è¡Œ
}

// âœ… æ­£ç¡® - async/await ç¡®ä¿ dispose
static Future<String?> input(BuildContext context, {...}) async {
  final controller = TextEditingController(text: initialValue);
  final result = await showDialog<String>(...);
  controller.dispose();  // ç¡®ä¿æ‰§è¡Œ
  return result;
}
```

---

## ä»£ç ç”Ÿæˆç›¸å…³

### ä½•æ—¶éœ€è¦è¿è¡Œ build_runner

ä»¥ä¸‹æƒ…å†µéœ€è¦é‡æ–°ç”Ÿæˆä»£ç ï¼š
1. ä¿®æ”¹äº† `database.dart` ä¸­çš„è¡¨å®šä¹‰
2. æ·»åŠ /åˆ é™¤äº†æ•°æ®åº“å­—æ®µ
3. ä¿®æ”¹äº†åˆ—å±æ€§ï¼ˆnullableã€é»˜è®¤å€¼ç­‰ï¼‰
4. é¦–æ¬¡å…‹éš†é¡¹ç›®å

### ç”Ÿæˆå‘½ä»¤

```bash
# æ ‡å‡†ç”Ÿæˆ
dart run build_runner build

# åˆ é™¤å†²çªåç”Ÿæˆï¼ˆæ¨èï¼‰
dart run build_runner build --delete-conflicting-outputs

# æ¸…ç†åç”Ÿæˆ
dart run build_runner build --delete-conflicting-outputs --clean
```

### ç”Ÿæˆçš„æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `lib/services/database/database.g.dart` | æ•°æ®åº“å®ç°ä»£ç  |
| `lib/services/database/database.drift.dart` | Drift ç±»å‹å®šä¹‰ |

---

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
flutter logs

# è¿‡æ»¤ç‰¹å®šæ ‡ç­¾
flutter logs | grep "ERROR"
```

### DevTools
```bash
# å¯åŠ¨ DevTools
flutter pub global activate devtools
flutter pub global run devtools
```

### æ–­ç‚¹è°ƒè¯•
1. åœ¨ VS Code ä¸­æŒ‰ `F5`
2. æˆ–ä½¿ç”¨ Android Studio çš„è°ƒè¯•æ¨¡å¼

---

## å¸¸ç”¨ç»´æŠ¤å‘½ä»¤

### æ¸…ç†ç¼“å­˜
```bash
# æ¸…ç†æ„å»ºç¼“å­˜
flutter clean

# æ¸…ç†å¹¶é‡æ–°è·å–ä¾èµ–
flutter clean && flutter pub get

# æ¸…ç†å¹¶é‡æ–°ç”Ÿæˆä»£ç 
flutter clean && flutter pub get && dart run build_runner build --delete-conflicting-outputs
```

### ä¾èµ–ç®¡ç†
```bash
# æŸ¥çœ‹è¿‡æ—¶çš„ä¾èµ–
flutter pub outdated

# å‡çº§æ‰€æœ‰ä¾èµ–
flutter pub upgrade

# å‡çº§ç‰¹å®šä¾èµ–
flutter pub upgrade package_name
```

---

## å¿«é€Ÿå‚è€ƒ

### å®Œæ•´é¦–æ¬¡ç¼–è¯‘æµç¨‹
```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd G:\8.CC\ThickNotepad

# 2. å®‰è£…ä¾èµ–
flutter pub get

# 3. ç”Ÿæˆæ•°æ®åº“ä»£ç 
dart run build_runner build --delete-conflicting-outputs

# 4. æ£€æŸ¥ä»£ç 
flutter analyze

# 5. è¿è¡Œ
flutter run
```

### ä¿®æ”¹æ•°æ®åº“åçš„å®Œæ•´æµç¨‹
```bash
# 1. ä¿®æ”¹ lib/services/database/database.dart
# 2. æ¸…ç†
flutter clean

# 3. é‡æ–°è·å–ä¾èµ–
flutter pub get

# 4. é‡æ–°ç”Ÿæˆä»£ç 
dart run build_runner build --delete-conflicting-outputs

# 5. è¿è¡Œ
flutter run
```

---

## é¡¹ç›®ç»“æ„æé†’

ç¼–è¯‘å‰ç¡®ä¿ä»¥ä¸‹ç›®å½•ç»“æ„å­˜åœ¨ï¼š
```
lib/
â”œâ”€â”€ services/database/
â”‚   â”œâ”€â”€ database.dart          # æ‰‹åŠ¨ç¼–è¾‘
â”‚   â”œâ”€â”€ database.g.dart        # è‡ªåŠ¨ç”Ÿæˆ
â”‚   â””â”€â”€ database.drift.dart    # è‡ªåŠ¨ç”Ÿæˆ
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ constants/
â”‚   â””â”€â”€ theme/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ notes/
â”‚   â”œâ”€â”€ reminders/
â”‚   â”œâ”€â”€ workout/
â”‚   â””â”€â”€ plans/
â””â”€â”€ shared/
    â”œâ”€â”€ pages/
    â””â”€â”€ widgets/
```

---

## ç‰ˆæœ¬ä¿¡æ¯

- **Flutter**: 3.38.8
- **Dart**: 3.10.7
- **Drift**: 2.28.2
- **Riverpod**: 2.6.1
- **go_router**: 14.8.1

---

## æœ€åæ›´æ–°

- **2025-01-29** - åˆå§‹ç‰ˆæœ¬ï¼Œè®°å½•é¦–æ¬¡ç¼–è¯‘è¿‡ç¨‹ä¸­é‡åˆ°çš„æ‰€æœ‰é—®é¢˜
- **2025-01-29** - æ·»åŠ  P0 åŠŸèƒ½å¼€å‘è¿‡ç¨‹ä¸­çš„ç¼–è¯‘é—®é¢˜ï¼ˆé—®é¢˜8-13ï¼‰
- **2026-01-30** - æ·»åŠ ç¼–è¯‘è·¯å¾„è¯´æ˜ã€PowerShell å‘½ä»¤ã€çœŸæœºè¿è¡Œæ­¥éª¤
- **2026-01-30** - æ·»åŠ ä»£ç å®¡æŸ¥é˜¶æ®µç¼–è¯‘é—®é¢˜ï¼ˆé—®é¢˜14-20ï¼‰

---

## ç¼–è¯‘é—®é¢˜å¿«é€Ÿç´¢å¼•

| # | é—®é¢˜ | å…³é”®è¯ | ç´§æ€¥åº¦ | ç±»å‹ |
|---|------|--------|--------|------|
| 1 | æ•°æ®åº“ä»£ç æœªç”Ÿæˆ | NotesCompanion | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 2 | Drift Column å†²çª | Ambiguous import | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 3 | Companion ç±»åä¸åŒ¹é… | NoteCompanion | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 4 | Value ç±»å‹é”™è¯¯ | Value<String?> | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 5 | isNotInValues ä¸å­˜åœ¨ | isNotInValues | ğŸŸ¡ ä¸­ | ç¼–è¯‘ |
| 6 | Gradle æ„å»ºå¤±è´¥ | unsupported Gradle | ğŸŸ¡ ä¸­ | æ„å»º |
| 7 | çƒ­é‡è½½ä¸ç”Ÿæ•ˆ | hot reload | ğŸŸ¢ ä½ | è¿è¡Œ |
| 8 | **å¼€å‘è€…æ¨¡å¼æœªå¯ç”¨** | symlink support | ğŸ”´ é«˜ | æ„å»º |
| 9 | **Core Library Desugaring** | desugaring | ğŸ”´ é«˜ | æ„å»º |
| 10 | **ç½‘ç»œè¿æ¥å¤±è´¥** | Connection reset | ğŸ”´ é«˜ | ç½‘ç»œ |
| 11 | **Web ä¸æ”¯æŒ sqlite3** | Only JS interop | ğŸŸ¡ ä¸­ | å¹³å° |
| 12 | **Kotlin ç¼“å­˜å†²çª** | different roots | ğŸŸ¡ ä¸­ | æ„å»º |
| 13 | **Riverpod Provider é”™è¯¯** | notifier isn't defined | ğŸŸ¡ ä¸­ | ä»£ç  |
| 14 | **æ•°æ®åº“ç´¢å¼•è¯­æ³•ä¸å…¼å®¹** | Index([updatedAt]) | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 15 | **WidgetRef ä¸ Ref ç±»å‹ä¸åŒ¹é…** | WidgetRef can't be assigned | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 16 | **Companion å‚æ•°éœ€è¦ drift.Value** | Value<String?> | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 17 | **å¼•ç”¨äº†ä¸å­˜åœ¨çš„ Provider** | Undefined name 'xxxProvider' | ğŸŸ¡ ä¸­ | ç¼–è¯‘ |
| 18 | **è¿è¡Œæ—¶ RangeError** | Invalid value: -1 | ğŸ”´ é«˜ | è¿è¡Œ |
| 19 | **LocaleDataException** | Locale data not initialized | ğŸ”´ é«˜ | è¿è¡Œ |
| 20 | **TextEditingController å†…å­˜æ³„æ¼** | dispose | ğŸŸ¡ ä¸­ | è¿è¡Œ |

---

## æ–°å¢ç¼–è¯‘é—®é¢˜ï¼ˆ2026-01-31ï¼‰

### é—®é¢˜ 21ï¼šnote_edit_page.dart copyWith å‚æ•°ç±»å‹é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
error - The argument type 'String' can't be assigned to the parameter type 'Value<String?>'
```

**åŸå› **ï¼šDrift çš„ copyWith æ–¹æ³•ä¸­ï¼Œå¯ç©ºå­—æ®µéœ€è¦ä½¿ç”¨ `drift.Value` åŒ…è£…

**è§£å†³æ–¹æ¡ˆ**ï¼š
```dart
import 'package:drift/drift.dart' as drift;

// âŒ é”™è¯¯ - ç›´æ¥ä¼ å€¼
_existingNote!.copyWith(
  title: title.isEmpty ? null : title,  // String ä¸èƒ½èµ‹å€¼ç»™ Value<String?>
  content: content,
)

// âœ… æ­£ç¡® - ä½¿ç”¨ drift.Value åŒ…è£…
_existingNote!.copyWith(
  title: title.isEmpty ? const drift.Value(null) : drift.Value(title),
  content: content,
)
```

---

### é—®é¢˜ 22ï¼šWorkoutType æšä¸¾ç¼ºå°‘ icon getter

**ç—‡çŠ¶**ï¼š
```
error - The getter 'icon' isn't defined for the type 'WorkoutType'
```

**åŸå› **ï¼šWorkoutType æšä¸¾å®šä¹‰åœ¨æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œä¸èƒ½ä¾èµ– Flutter çš„ IconData

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨é¡µé¢æ–‡ä»¶ä¸­æ·»åŠ è¾…åŠ©å‡½æ•°
```dart
// åœ¨ workout_detail_page.dart ä¸­æ·»åŠ 
IconData _getWorkoutIcon(WorkoutType type) {
  switch (type) {
    case WorkoutType.running:
      return Icons.directions_run;
    case WorkoutType.cycling:
      return Icons.directions_bike;
    // ... å…¶ä»–ç±»å‹
    case WorkoutType.other:
      return Icons.sports;
  }
}

// ä½¿ç”¨æ—¶
Icon(_getWorkoutIcon(typeEnum))
```

---

### é—®é¢˜ 23ï¼šgo_router è·¯ç”±é¡ºåºé”™è¯¯

**ç—‡çŠ¶**ï¼š
```
FormatException: Invalid radix-10 number (at character 1)
new
^
```

**åŸå› **ï¼š`/notes/new` è·¯ç”±å®šä¹‰åœ¨ `/notes/:id` ä¹‹åï¼Œgo_router å…ˆåŒ¹é…åˆ° `:id` å‚æ•°ï¼Œå°è¯•å°† `'new'` è§£æä¸ºæ•´æ•°

**è§£å†³æ–¹æ¡ˆ**ï¼šå°† new è·¯ç”±æ”¾åœ¨ :id è·¯ç”±ä¹‹å‰
```dart
// âŒ é”™è¯¯é¡ºåº
GoRoute(path: '/notes/:id', ...),
GoRoute(path: '/notes/new', ...),

// âœ… æ­£ç¡®é¡ºåº
GoRoute(path: '/notes/new', ...),
GoRoute(path: '/notes/:id', ...),
```

---

### é—®é¢˜ 24ï¼šplan_edit_page.dart æ–‡ä»¶ä¸å­˜åœ¨

**ç—‡çŠ¶**ï¼š
```
error - Error when reading 'lib/features/plans/presentation/pages/plan_edit_page.dart'
```

**åŸå› **ï¼šé¡¹ç›®æœªåˆ›å»ºè®¡åˆ’ç¼–è¾‘é¡µé¢

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆ›å»º `plan_edit_page.dart` æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- æ ‡é¢˜è¾“å…¥æ¡†
- æè¿°è¾“å…¥æ¡†
- åˆ†ç±»é€‰æ‹©å™¨ï¼ˆè¿åŠ¨/ä¹ æƒ¯/å­¦ä¹ /å·¥ä½œ/å…¶ä»–ï¼‰
- ä¿å­˜åè·³è½¬åˆ°è®¡åˆ’è¯¦æƒ…é¡µ

---

### é—®é¢˜ 25ï¼šPlanDetailPage æ„é€ å‡½æ•°ç¼ºå°‘ required

**ç—‡çŠ¶**ï¼š
```
error - The parameter 'planId' can't have a value of 'null' because of its type 'int'
```

**åŸå› **ï¼šsed å‘½ä»¤ä¿®æ”¹æ–‡ä»¶æ—¶ç ´åäº†è¯­æ³•

**è§£å†³æ–¹æ¡ˆ**ï¼š
```dart
// âœ… æ­£ç¡®
class PlanDetailPage extends ConsumerStatefulWidget {
  final int planId;

  const PlanDetailPage({super.key, required this.planId});
}
```

---

### é—®é¢˜ 26ï¼šPlansCompanion.insert ç¼ºå°‘ category å‚æ•°

**ç—‡çŠ¶**ï¼š
```
error - Required named parameter 'category' must be provided
```

**åŸå› **ï¼šæ•°æ®åº“ä¸­ category å­—æ®µæ˜¯å¿…å¡«çš„

**è§£å†³æ–¹æ¡ˆ**ï¼š
```dart
PlansCompanion.insert(
  title: title,
  category: _selectedCategory,  // æ·»åŠ å¿…å¡«çš„ category
  description: drift.Value(_descriptionController.text.trim()),
  startDate: DateTime.now(),
  targetDate: DateTime.now().add(const Duration(days: 30)),
)
```

---

### é—®é¢˜ 27ï¼šcreatePlan è¿”å› int è€Œé Plan å¯¹è±¡

**ç—‡çŠ¶**ï¼š
```
error - The getter 'id' isn't defined for the type 'int'
```

**åŸå› **ï¼š`createPlan` æ–¹æ³•è¿”å›çš„æ˜¯æ–°åˆ›å»ºè®°å½•çš„ IDï¼ˆintï¼‰ï¼Œä¸æ˜¯ Plan å¯¹è±¡

**è§£å†³æ–¹æ¡ˆ**ï¼š
```dart
// âŒ é”™è¯¯
final plan = await repo.createPlan(...);
context.push('${AppRoutes.plans}/${plan.id}');

// âœ… æ­£ç¡®
final planId = await repo.createPlan(...);
context.push('${AppRoutes.plans}/$planId');
```

---

## ç¼–è¯‘é—®é¢˜å¿«é€Ÿç´¢å¼•ï¼ˆæ›´æ–°ï¼‰

| # | é—®é¢˜ | å…³é”®è¯ | ç´§æ€¥åº¦ | ç±»å‹ |
|---|------|--------|--------|------|
| ... | ... | ... | ... | ... |
| 21 | **copyWith å‚æ•°ç±»å‹é”™è¯¯** | drift.Value | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 22 | **WorkoutType.icon ä¸å­˜åœ¨** | icon getter | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 23 | **è·¯ç”±é¡ºåºé”™è¯¯** | route order | ğŸ”´ é«˜ | è¿è¡Œ |
| 24 | **plan_edit_page.dart ä¸å­˜åœ¨** | file not found | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 25 | **planId ç¼ºå°‘ required** | required modifier | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 26 | **PlansCompanion.insert ç¼ºå°‘ category** | category required | ğŸ”´ é«˜ | ç¼–è¯‘ |
| 27 | **createPlan è¿”å› int é Plan** | int planId | ğŸ”´ é«˜ | ä»£ç  |

---
